<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Cart - Karu Stripe Integration</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a2e;
        color: white;
      }
      .product {
        border: 1px solid #00a6fb;
        padding: 20px;
        margin: 10px 0;
        border-radius: 10px;
        background: rgba(0, 166, 251, 0.1);
      }
      .btn {
        background: #00a6fb;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0088d1;
      }
      .cart {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #252a34;
        padding: 20px;
        border-radius: 10px;
        min-width: 300px;
        max-height: 400px;
        overflow-y: auto;
      }
      .cart-item {
        border-bottom: 1px solid #444;
        padding: 10px 0;
      }
      #cart-total {
        color: #00a6fb;
        font-weight: bold;
        font-size: 1.2em;
      }
      .test-log {
        background: #252a34;
        padding: 15px;
        margin: 20px 0;
        border-radius: 10px;
        border-left: 4px solid #ffc144;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test Karu Cart - Pure Stripe Integration</h1>

    <div class="test-log">
      <h3>üìã Test Instructions:</h3>
      <ol>
        <li>Add products to cart</li>
        <li>Check console for Stripe initialization</li>
        <li>Click "Proc√©der au paiement" to test checkout</li>
        <li>Verify Stripe Price IDs are loaded</li>
      </ol>
    </div>

    <div class="product">
      <h3>Karu Deck - Standard Edition</h3>
      <p>Price: 14.99‚Ç¨</p>
      <p>Description: 100+ cartes anime, design exclusif, bo√Æte de rangement</p>
      <button class="btn" onclick="addToCart('standard')">
        Add Standard Deck
      </button>
      <button
        class="btn btn-stripe"
        data-stripe-product="standard"
        onclick="stripeBuyNow('standard')"
      >
        Buy Now (Stripe)
      </button>
    </div>

    <div class="product">
      <h3>Karu Deck - Competition Edition</h3>
      <p>Price: 19.99‚Ç¨</p>
      <p>
        Description: 100+ cartes anime, bo√Æte collector magn√©tique, cartes
        exclusives limit√©es
      </p>
      <button class="btn" onclick="addToCart('competition')">
        Add Competition Deck
      </button>
      <button
        class="btn btn-stripe"
        data-stripe-product="competition"
        onclick="stripeBuyNow('competition')"
      >
        Buy Now (Stripe)
      </button>
    </div>

    <!-- Mini Cart Display -->
    <div class="cart">
      <h3>üõí Panier</h3>
      <div id="cart-items-test"></div>
      <div
        style="border-top: 1px solid #444; padding-top: 10px; margin-top: 10px"
      >
        <strong>Total: <span id="cart-total-test">0‚Ç¨</span></strong>
      </div>
      <button
        class="btn cart-checkout-test"
        onclick="proceedToCheckout()"
        style="width: 100%; margin-top: 10px"
      >
        Proc√©der au paiement
      </button>
    </div>

    <!-- Test Status -->
    <div class="test-log">
      <h3>üîç Test Status:</h3>
      <div id="test-status">
        <p>‚úÖ Loading scripts...</p>
      </div>
    </div>

    <!-- Include all necessary scripts -->
    <script src="stripe-config.js"></script>
    <script src="script.js"></script>
    <script src="stripe-payments.js"></script>

    <script>
      // Test-specific enhancements
      let testStatus = document.getElementById("test-status");

      // Override cart display for test page
      function updateCartDisplay() {
        const cartItemsTest = document.getElementById("cart-items-test");
        const cartTotalTest = document.getElementById("cart-total-test");

        cartTotal = cart.reduce(
          (total, item) => total + item.price * item.quantity,
          0
        );
        cartTotalTest.textContent = `${cartTotal.toFixed(2)}‚Ç¨`;

        cartItemsTest.innerHTML = "";

        if (cart.length === 0) {
          cartItemsTest.innerHTML = '<p style="color: #888;">Panier vide</p>';
          return;
        }

        cart.forEach((item) => {
          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div>
                            <strong>${item.title}</strong><br>
                            <small>${item.price}‚Ç¨ x ${item.quantity}</small><br>
                            <small style="color: #FFC144;">Price ID: ${item.stripePriceId || "Not set"}</small>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" style="background: #FF2E63; border: none; color: white; padding: 5px; border-radius: 3px;">√ó</button>
                    </div>
                `;
          cartItemsTest.appendChild(cartItem);
        });
      }

      // Test initialization
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          let status = "<p>‚úÖ Scripts loaded</p>";

          if (typeof STRIPE_CONFIG !== "undefined") {
            status += "<p>‚úÖ STRIPE_CONFIG loaded</p>";
            status += `<p>üì± Publishable Key: ${STRIPE_CONFIG.publishableKey.substring(0, 20)}...</p>`;
          } else {
            status += "<p>‚ùå STRIPE_CONFIG missing</p>";
          }

          if (typeof products !== "undefined") {
            status += "<p>‚úÖ Products object loaded</p>";
            status += `<p>üéØ Standard Price ID: ${products.standard.stripePriceId}</p>`;
            status += `<p>üéØ Competition Price ID: ${products.competition.stripePriceId}</p>`;
          } else {
            status += "<p>‚ùå Products object missing</p>";
          }

          if (window.karuStripePayments) {
            status += "<p>‚úÖ Stripe payments initialized</p>";
          } else {
            status += "<p>‚ùå Stripe payments not initialized</p>";
          }

          testStatus.innerHTML = status;
        }, 1000);
      });

      // Override notification for test
      function showNotification(message, type = "info") {
        console.log(`[${type.toUpperCase()}] ${message}`);
        alert(`${type.toUpperCase()}: ${message}`);
      }

      // Test cart functions
      function openCart() {
        console.log("Cart opened (test mode)");
      }

      function closeCart() {
        console.log("Cart closed (test mode)");
      }
    </script>
  </body>
</html>
